{{>header}}

<style>
    .panel{
        border: 1px solid #fff;
        border-radius: 8px;
    }
    .panel-heading{
        background-color: #003399;
        color: #fff;
        padding: 16px;
        font-family: 'Playfair Display', serif !important;
        font-weight: bold;
        font-size: 22px;
    }
    small a{
        color: #fff !important;
        font-family: 'Source Sans Pro', sans-serif !important;
        font-size: 14px !important;
        font-weight: 400;
    }
    .panel-body{
        padding: 16px;
    }
    .panel-body h4{
         font-family: 'Source Sans Pro', sans-serif !important;
        font-size: 20px !important;
        font-weight: 600;
    }
    .panel-body .form-group strong{
        font-family: 'Source Sans Pro', sans-serif !important;
        font-weight: 600;
    }
    #rzp-button1{
        background-color: #003399;
        font-family: 'Source Sans Pro', sans-serif !important;
        font-weight: 600;
        font-size: 16px;
        border: none;
        padding-left: 32px;
        padding-right: 32px;
        padding-top: 10px;
        padding-bottom: 10px;
    }



        .coupon_button{
        background-color: #003399;
        padding-top: 8px;
        padding-bottom: 8px;
        padding-left: 32px;
        padding-right: 32px;
        border: none;
        color: #fff;
        border-radius: 50px;
    }
    #coupon_form input{
        border: none;
        border-bottom: 2px solid #003399;
        padding: 8px;
    }
    #coupon_form input:focus-visible{
        box-shadow: none;
        outline: none;
    }
    @media (max-width:767px){
        .coupon_button{
            margin-top: 15px !important;
        }
    }
    .pop_box{
        background-color: rgb(33, 143, 33, 0.9);
        float: right;
        padding: 26px;
        border-radius: 4px;
         box-shadow: 2px 3px 2px 2px rgba(109, 82, 82, 0.3);
         position: absolute;
         right: 3%;
         top: 15%;
         z-index: 10000;
        
    }
    .pop_box2{
        background-color: rgba(204, 28, 42, 0.9);
        float: right;
        padding: 26px;
        border-radius: 4px;
         box-shadow: 2px 3px 2px 2px rgba(109, 82, 82, 0.3);
         position: absolute;
         right: 3%;
         top: 15%;
         z-index: 10000;
    }
    .pop_box #text h5{
        color: #fff;
        font-family: 'Source Sans Pro', sans-serif !important;
        font-weight: 600;
        font-size: 20px;
    }
    .pop_box2 #text h5{
        color: #fff;
        font-family: 'Source Sans Pro', sans-serif !important;
        font-weight: 600;
        font-size: 20px;
    }
</style>

<section>
    <div class="container wrapper mt-4">

    <div class="row mb-2 mt-1 text-right">
        <div class="col-lg-4 text-right" id="popup">
                       
        </div>
    </div>

    <div class="row mt-4 cart-body">
          <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 order-lg-1 order-md-1 order-sm-2 order-2">
            <!--SHIPPING METHOD-->
            <div class="panel shadow panel-info">
                <div class="panel-heading">Address</div>
                <div class="panel-body">
                    <div class="form-group">
                        <div class="col-md-12">
                            <h4>Shipping Address</h4>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="row">
                            <div class="col-lg-6 col-md-6 col-xs-12">
                                <strong>First Name</strong>
                                <input type="text" id="first_name" name="first_name" class="form-control" value="" />
                                <div id="first_name_msg" style="font-size: 12px;color: red;"></div>
                            </div>

                           
                            <div class="col-lg-6 col-md-6 col-xs-12">
                                <strong>Last Name</strong>
                                <input type="text" name="last_name" class="form-control" value="" />
                                
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-12" style="    padding-top: 10px"><strong>Address:</strong></div>
                        <div class="col-md-12">
                            <input type="text" id="address" name="address" class="form-control" value="" />
                            <div id="address_msg" style="font-size: 12px;color: red;"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-12" style="    padding-top: 10px"><strong>City:</strong></div>
                        <div class="col-md-12">
                            <input type="text" id="city" name="city" class="form-control" value="" />
                            <div id="city_msg" style="font-size: 12px;color: red;"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-12" style="    padding-top: 10px"><strong>Zip / Postal Code:</strong>
                        </div>
                        <div class="col-md-12">
                            <input type="text" id="zip_code" name="zip_code" class="form-control" value="" />
                            <div id="zip_code_msg" style="font-size: 12px;color: red;"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-12" style="    padding-top: 10px"><strong>Phone Number:</strong></div>
                        <div class="col-md-12"><input type="text" id="phone_number" name="phone_number"
                                class="form-control" value="" />
                            <div id="phone_number_msg" style="font-size: 12px;color: red;"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-12" style="    padding-top: 10px"><strong>Email Address:</strong></div>
                        <div class="col-md-12"><input type="text" id="email" name="email" class="form-control"
                                value="" />
                            <div id="email_msg" style="font-size: 12px;color: red;"></div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 order-lg-2 order-md-2 order-sm-1 order-1">
            <!--REVIEW ORDER-->
            <div class="panel shadow panel-info">
                <div class="panel-heading">
                    Review Order <div class="pull-right"><small><a class="afix-1" href="/shopping-cart">Edit
                                Cart</a></small></div>
                </div>
                <div class="panel-body">
                    <div class="form-group row">
                        <div class="col-sm-3 col-xs-3">
                            <img class="img-responsive" src="{{products.image}}" alt="" />
                        </div>
                        <div class="col-sm-6 col-xs-6">
                            <div class="col-xs-12">{{products.title}}</div>
                            <input type="hidden" class="title" value="{{products.title}}" />
                            {{!-- <div class="col-xs-12"><small>Quantity:<span>{{products.qty}}</span></small></div> --}}
                        </div>
                        <div class="col-sm-3 col-xs-3 text-right">
                            <h6 style="float: right;"><span><i class="fa fa-rupee"></i></span>{{products.sellingPrice}}</h6>
                        </div>
                    </div>
                    <div class="form-group">
                        <hr />
                    </div>


                    <div class="form-group">
                        <div class="col-xs-12">
                            <strong>Subtotal</strong>
                            <div class="pull-right"><span><i
                                        class="fa fa-rupee"></i></span><span>{{subtotal}}</span></div>
                        </div>
                        <div class="col-xs-12">
                            <strong>Shipping Charge</strong>
                            <div class="pull-right"><span><i
                                        class="fa fa-rupee"></i></span><span>{{shippingCharge}}</span></div>
                        </div>
                        <div class="col-xs-12">
                            <strong>Tax</strong>
                            <div class="pull-right"><span><i
                                        class="fa fa-rupee"></i></span><span>{{tax}}</span></div>
                        </div>
                        {{#if couponApply}}
                            <div class="col-xs-12 mt-2 mb-2">
                                <strong>Coupon Discount</strong>
                                <div class="pull-right">
                                    <span>
                                        <i class="fa fa-rupee"></i>
                                    </span>
                                    <span>{{couponAmount}}</span>

                                </div>
                            </div>
                        {{/if}}
                        <div class="col-xs-12">
                            <strong>Order Total</strong>
                            <div class="pull-right"><span><i
                                        class="fa fa-rupee"></i></span><span>{{total}}</span></div>
                        </div>
                        <div>
                            <form id="coupon_form" method="get" action="/products/checkout/{{products.title}}">
                                {{!-- <input type="hidden" name="_csrf" value="{{ csrfToken }}" /> --}}
                                {{!-- <input type="text" value="{{cart._id}}"> --}}
                                <input type="text" name="coupon" id="coupon" required>
                                <button class="coupon_button shadow" type="submit">Apply Coupon</button>
                            </form>
                        </div>
                    </div>
                    <div class="form-group mt-4">
                        <div class="col-xs-12 mt-2">
                            <div class="buttons">
                                <button id="rzp-button1" class="btn btn-success btn-block">Proceed to Payment</button> 
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--REVIEW ORDER END-->
        </div>
        <input type="hidden" name="" id="rzp-text">


        <script>
            window.onload = function (e) {

                var url = "/createOrder"
                var params = {
                    amount: "{{total}}00",
                    currency: "INR",
                    receipt: "lavna_recipt"
                };
                var xmlHttp = new XMLHttpRequest();
                xmlHttp.onreadystatechange = function (res) {
                    if (xmlHttp.readyState === 4) {
                        res = JSON.parse(xmlHttp.responseText);
                        document.getElementById("rzp-text").value = res.sub.id
                    }
                }
                xmlHttp.open("POST", url, true);
                xmlHttp.setRequestHeader("Content-type", "application/json");
                xmlHttp.setRequestHeader("X-CSRF-Token", "{{csrfToken}}");
                xmlHttp.send(JSON.stringify(params));
            }
        </script>
        <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
        <script>
            document.getElementById("rzp-button1").onclick = function (e) {

                var firstname = document.getElementById("first_name").value;
                var address = document.getElementById("address").value;
                var phone = document.getElementById("phone_number").value;
                var city = document.getElementById("city").value;
                var zip = document.getElementById("zip_code").value;
                var email = document.getElementById("email").value;
                var titles = document.getElementsByClassName('title');
                var result = "";
                for (var i = 0, len = titles.length | 0; i < len; i = i + 1 | 0) {
                    result += titles[i].defaultValue + " | ";
                }
                if (firstname === '' || firstname == undefined) {
                    document.getElementById("first_name_msg").innerHTML = "Please enter First Name."
                    return;
                }

                if (address === '' || address == undefined) {
                    document.getElementById("address_msg").innerHTML = "Please enter Address."
                    return;
                }


                if (city === '' || city == undefined) {
                    document.getElementById("city_msg").innerHTML = "Please enter City."
                    return;
                }

                if (phone === '' || phone == undefined) {
                    document.getElementById("phone_number_msg").innerHTML = "Please enter Phone number."
                    return;
                }

                if (zip === '' || zip == undefined) {
                    document.getElementById("zip_code_msg").innerHTML = "Please enter Zip code."
                    return;
                }

                if (email === '' || email == undefined) {
                    document.getElementById("email_msg").innerHTML = "Please enter Email."
                    return;
                }

                var postData = {
                    "firstname": firstname,
                    "address": address,
                    "city": city,
                    "phone": phone,
                    "zip": zip,
                    "email": email,
                    "titles": result.substring(0, result.length - 2),
                    "amount": "{{total}}00"
                }
                var options = {
                    "key": "{{key}}",
                    "currency": "INR",
                    "amount":`{{total}}00`,
                    "name": "Lavna Locks",
                    "description": "Lavna Locks Payment Gateway",
                    "order_id": document.getElementById("rzp-text").value,
                    "handler": function (response) {
                        var url = "/confirmGuestOrder"
                        console.log(JSON.stringify(response))
                        var params = {
                            order_pay_id: response.razorpay_payment_id,
                            order_id: response.razorpay_order_id,
                            order_sig: response.razorpay_signature,
                            postDataJson: postData
                        };
                        console.log(JSON.stringify(params))
                        var xmlHttp = new XMLHttpRequest();
                        xmlHttp.onreadystatechange = function (res) {
                            if (xmlHttp.readyState === 4) {
                                res = JSON.parse(xmlHttp.responseText);
                                let status = res["status"];
                                if (status == "SUCCESS") {
                                    if("{{products.title}}" === "L-A24-Black(Bluetooth)" || "{{products.title}}" === "L-A24-GOLD" || "{{products.title}}" === "L-A28-Black(Bluetooth)" || "{{products.title}}" === "L-A28-GOLD"){
                                    gtag_report_conversion("/successpayment");
                                    }else{
                                      window.location.href = "/successpayment";
                                    }
                                   
                                }
                                if (status == "failure") {
                                    window.location.href = "/errorpayment";
                                }
                            }
                        }
                        xmlHttp.open("POST", url, true);
                        xmlHttp.setRequestHeader("Content-type", "application/json");
                        xmlHttp.setRequestHeader("X-CSRF-Token", "{{csrfToken}}");
                        xmlHttp.send(JSON.stringify(params));
                    },
                    "theme": {
                        "color": "#0EB9F2"
                    }
                };
                var rzp1 = new Razorpay(options);
                rzp1.open();
                rzp1.on('payment.failed', function (response) {
                    console.log(JSON.stringify(response));
                    window.location.href = "/errorpayment"
                });
                e.preventDefault();
            }
        </script>
    </div>
</div>
</section>


<!-- ======= Footer ======= -->
<footer id="footer">
    <div class="container">
        <div class="footer-top">
            <div class="row">
                <div class="col-lg-12">
                    <a href="/" class="logo me-auto"><img width="20%" src="../../public/assets/new_assets/img2/Logo.webp"
                            alt="Lavna_logo"></a>
                </div>
            </div>
        </div>
        <div class="footer-mid">
            <div class="row mt-4">
                <div class="col-lg-5">
                    <div class="box">
                        <h4>Subscribe to our newsletter</h4>
                        <form id="contact-form2">
                            <input type="email" name="email" id="emailsb" placeholder="Enter Your Email"
                                required><button type="submit" id="submit-modal2">Subscribe Us</button>
                        </form>

                    </div>
                </div>
                <div class="col-lg-4">
                    <h4 class="link">Links</h4>
                    <ul>
                        <li><a href="/">Home</a></li>
                        <li><a href="/about">About</a></li>
                        <li><a href="/shop">Products</a></li>
                        <li><a href="/builder">Builder’s Project</a></li>
                        <li><a href="/privacypolicy">Privacy Policy</a></li>
                    </ul>
                </div>
                <div class="col-lg-3">
                    <h4 class="link">Contact Us</h4>
                    <ul>
                        <li><a href="tel:+91-18003134491"><i class="fa fa-phone"></i> +91-18003134491</a></li>
                        <li> <a href="mailto:sales@lavnalocks.com"><i class="fa fa-envelope"></i>
                                sales@lavnalocks.com</a></li>
                    </ul>
                    <ul class="lastul">
                        <li><a target="_blank" href="https://www.facebook.com/bhagwnshrilocksprivatelimited/"><img
                                    src="../../public/assets/new_assets/img2/facebook (2).svg" alt="facebook"></a></li>
                        <li><a target="_blank" href="https://www.instagram.com/lavnalocks/"><img
                                    src="../../public/assets/new_assets/img2/instagram (1).svg" alt="instagram"></a></li>
                        <li><a target="_blank" href="https://youtu.be/Yst8KW2Vm4M"><img
                                    src="../../public/assets/new_assets/img2/Vector (13).webp" alt="youtube"></a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <div id="f_bottom" class="container-fluid">
        <div class="row text-center">
            <div class="col-lg-12 footer-bottom">
                <div class="copyright">
                    &copy; 2022 LAVNA Locks is a Unit of Bhagwn Shri Locks PVT. LTD. All Rights Reserved.
                </div>
            </div>
        </div>
    </div>
</footer>
<!-- End Footer -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Vendor JS Files -->
<script src="../../public/assets/new_assets/vendor/aos/aos.js"></script>
<script src="../../public/assets/new_assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../../public/assets/new_assets/vendor/swiper/swiper-bundle.min.js"></script>

<!-- Template Main JS File -->
<script src="../../public/assets/new_assets/js/main.js"></script>
<script src="../../public/assets/new_assets/js/owl.min.js"></script>
<script src="../../public/assets/new_assets/js/custom.js"></script>


<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js">
</script>


<script type="text/javascript">
        (function () {
            emailjs.init("user_mTjMBBP092bpZsnZTyLfp");
        })();
</script>


<script>
    var swiper = new Swiper("#prd_thumb", {
        slidesPerView: 5.5,
        spaceBetween: 20,

        navigation: {
            nextEl: "#prd_thumb .swiper-button-next",
            prevEl: "#prd_thumb .swiper-button-prev",
        },

    });



    $(document).ready(function () {

        $('.chn_img').click(function () {

            $('.chn_img').removeClass('active');
            $(this).addClass('active');
            var target = $(this).attr('data-target');
            var src = $(this).attr('data-img');

            $(target).attr('src', src);

        });

    });

</script>

{{!-- 
<script>
    $(document).ready(function () {
        $("#contact-form").submit(function (e) {

            $('#submit-modal').html('Sending...');
            e.preventDefault();

            var Name = document.getElementById("name").value;
            var emailId = document.getElementById("email").value;
            var mobile = document.getElementById("mobile").value;
            var product = document.getElementById("product").value;
            var message = document.getElementById("message").value;

            if (Name === '' || Name == undefined) {
                return;
            }
            if (emailId === '' || emailId == undefined) {
                return;
            }
            if (mobile === '' || mobile == undefined) {
                return;
            }
            if (product === '' || product == undefined) {
                return;
            }
            if (message === '' || message == undefined) {
                return;
            }

            var Body = 'Name: ' + Name + '<br>Email: ' + emailId + '<br>Mobile: ' + mobile + '<br>Product: ' + product + '<br>Message: ' + message;
            $('#name').val('');
            $('#email').val('');
            $('#mobile').val('');
            $('#product').val('');
            $('#message').val('');

            sendMailToOwner(Body, Name, emailId, mobile, product, message);
        });

    });


    function sendMailToOwner(Body, Name, emailId, mobile, product, message) {

        var data = {
            service_id: 'service_8zp4yhp',
            template_id: 'template_r8bl13q',
            user_id: 'user_mTjMBBP092bpZsnZTyLfp',
            template_params: {
                'from_name': Name,
                'user_name': Name,
                'user_email': emailId,
                'user_mobile': mobile,
                'product': product,
                'reply_to': 'contact@flybunch.com',
                'owner_email': 'ps1089124@gmail.com',
                'company': 'Lavnalocks',
                'message': message,
            }
        };

        $.ajax('https://api.emailjs.com/api/v1.0/email/send', {
            type: 'POST',
            data: JSON.stringify(data),
            contentType: 'application/json'
        }).done(function () {
            $('#submit-modal').html('Send');
            $('#closemodal').trigger('click');
        }).fail(function (error) {
            alert('Oops... ' + JSON.stringify(error));
        });

    }

</script> --}}

<script>
$(document).ready(function(){
    $("#contact-form2").submit(function(e) {
  $('#submit-modal2').html('Sending...');
            e.preventDefault();
        var emailId = document.getElementById("emailsb").value;
        if(emailId ==='' || emailId == undefined )
        {
            return;
        }
        var Body ='Email: '+emailId;
  $('#emailsb').val('');

  sendMailToUser(emailId);
  sendMailToOwner(Body, emailId);
        });

    });


function sendMailToUser(emailId){

var data = {
service_id: 'service_8zp4yhp',
template_id: 'template_kvsj7kk',
user_id: 'user_mTjMBBP092bpZsnZTyLfp',
template_params: {
    'user_email':emailId,
    'reply_to':'contact@lavnalocks.com',
        'company':"Lavnalocks",

}

};

$.ajax('https://api.emailjs.com/api/v1.0/email/send', {
type: 'POST',
data: JSON.stringify(data),
contentType: 'application/json'
}).done(function(msg) {
// alert(msg);
$('#submit-modal').html('Send');
swal("Thank You!", "Your have subscribe lavnalocks", "success");
$('#closemodal').trigger('click');
}).fail(function(error) {
alert('Oops... user mail failed' + JSON.stringify(error));
});

}


function sendMailToOwner(Body, emailId){
var data = {
service_id: 'service_8zp4yhp',
template_id: 'template_mxovugp',
user_id: 'user_mTjMBBP092bpZsnZTyLfp',
template_params: {
     'user_email': emailId ,
     'reply_to':'contact@lavnalocks.com', 
     'owner_email': 'sales@lavnalocks.com',
     'company': 'Lavnalocks',
}

};

$.ajax('https://api.emailjs.com/api/v1.0/email/send', {
type: 'POST',
data: JSON.stringify(data),
contentType: 'application/json'
}).done(function() {
$('#submit-modal').html('Send');
swal("Thank You!", "Your Query has been submitted!", "success");
$('#closemodal').trigger('click');
}).fail(function(error) {
alert('Oops... ' + JSON.stringify(error));
});

}

</script>

<script>
    if({{popup}} == 1){
        document.getElementById("popup").innerHTML = `<div class="pop_box">
                <div id="text">
                    <h5>Coupon Successfully Applied</h5>
                </div>
            </div> `
    setTimeout(()=>{
       document.getElementById("popup").innerHTML = ``
    },1000)
    }

    if({{popup}} == 2){
        document.getElementById("popup").innerHTML = `<div class="pop_box2">
                <div id="text">
                    <h5>Invalid Coupon</h5>
                </div>
            </div> `
    setTimeout(()=>{
       document.getElementById("popup").innerHTML = ``
    },1000)
    }
</script>

<script>
    $(document).ready(function(){
        $("#togg").click(function(){
            $("#navbar").toggle();
        });
    });
</script>

<script async src="https://www.googletagmanager.com/gtag/js?id=AW-10822033569"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'AW-10822033569');
</script>

<!-- Event snippet for Website lead conversion page
In your html page, add the snippet and call gtag_report_conversion when someone clicks on the chosen link or button. -->
<script>
function gtag_report_conversion(url) {
  var callback = function () {
    if (typeof(url) != 'undefined') {
      window.location = url;
    }
  };
  gtag('event', 'conversion', {
      'send_to': 'AW-10822033569/QCBoCLHn1ZYDEKHBrKgo',
      'transaction_id': '',
      'event_callback': callback
  });
  return false;
}
</script>

</body>

</html>
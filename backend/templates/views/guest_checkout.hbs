{{>header}}

<style>
    .panel{
        border: 1px solid #fff;
        border-radius: 8px;
    }
    .panel-heading{
        background-color: #003399;
        color: #fff;
        padding: 16px;
        font-family: 'Playfair Display', serif !important;
        font-weight: bold;
        font-size: 22px;
    }
    small a{
        color: #fff !important;
        font-family: 'Source Sans Pro', sans-serif !important;
        font-size: 14px !important;
        font-weight: 400;
    }
    .panel-body{
        padding: 16px;
    }
    .panel-body h4{
         font-family: 'Source Sans Pro', sans-serif !important;
        font-size: 20px !important;
        font-weight: 600;
    }
    .panel-body .form-group strong{
        font-family: 'Source Sans Pro', sans-serif !important;
        font-weight: 600;
    }
    #rzp-button1{
        background-color: #003399;
        font-family: 'Source Sans Pro', sans-serif !important;
        font-weight: 600;
        font-size: 16px;
        border: none;
        padding-left: 32px;
        padding-right: 32px;
        padding-top: 10px;
        padding-bottom: 10px;
    }
</style>

<section>
    <div class="container wrapper mt-4">
    <div class="row cart-body">
          <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
            <!--SHIPPING METHOD-->
            <div class="panel shadow panel-info">
                <div class="panel-heading">Address</div>
                <div class="panel-body">
                    <div class="form-group">
                        <div class="col-md-12">
                            <h4>Shipping Address</h4>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="row">
                            <div class="col-lg-6 col-md-6 col-xs-12">
                                <strong>First Name</strong>
                                <input type="text" id="first_name" name="first_name" class="form-control" value="" />
                                <div id="first_name_msg" style="font-size: 12px;color: red;"></div>
                            </div>

                           
                            <div class="col-lg-6 col-md-6 col-xs-12">
                                <strong>Last Name</strong>
                                <input type="text" name="last_name" class="form-control" value="" />
                                
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-12" style="    padding-top: 10px"><strong>Address</strong></div>
                        <div class="col-md-12">
                            <input type="text" id="address" name="address" class="form-control" value="" />
                            <div id="address_msg" style="font-size: 12px;color: red;"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-12" style="    padding-top: 10px"><strong>City</strong></div>
                        <div class="col-md-12">
                            <input type="text" id="city" name="city" class="form-control" value="" />
                            <div id="city_msg" style="font-size: 12px;color: red;"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-12" style="    padding-top: 10px"><strong>Zip / Postal Code</strong>
                        </div>
                        <div class="col-md-12">
                            <input type="text" id="zip_code" name="zip_code" class="form-control" value="" />
                            <div id="zip_code_msg" style="font-size: 12px;color: red;"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-12" style="    padding-top: 10px"><strong>Phone Number</strong></div>
                        <div class="col-md-12"><input type="text" id="phone_number" name="phone_number"
                                class="form-control" value="" />
                            <div id="phone_number_msg" style="font-size: 12px;color: red;"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-12" style="    padding-top: 10px"><strong>Email Address</strong></div>
                        <div class="col-md-12"><input type="text" id="email" name="email" class="form-control"
                                value="" />
                            <div id="email_msg" style="font-size: 12px;color: red;"></div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
            <!--REVIEW ORDER-->
            <div class="panel shadow panel-info" style="margin-left: 100px;">
                <div class="panel-heading">
                    Review Order <div class="pull-right"><small><a class="afix-1" href="/shopping-cart">Edit
                                Cart</a></small></div>
                </div>
                <div class="panel-body">
                    {{#each products}}
                    <div class="form-group row">
                        <div class="col-sm-3 col-xs-3">
                            <img class="img-responsive" src="{{this.image}}" />
                        </div>
                        <div class="col-sm-6 col-xs-6">
                            <div class="col-xs-12">{{this.title}}</div>
                            <input type="hidden" class="title" value="{{this.title}}" />
                            <div class="col-xs-12"><small>Quantity:<span>{{this.qty}}</span></small></div>
                        </div>
                        <div class="col-sm-3 col-xs-3 text-right">
                            <h6 style="float: right;"><span><i class="fa fa-rupee"></i></span>{{this.totalPrice}}</h6>
                        </div>
                    </div>
                    <div class="form-group">
                        <hr />
                    </div>
                    {{/each}}


                    <div class="form-group">
                        <div class="col-xs-12">
                            <strong>Order Total</strong>
                            <div class="pull-right"><span><i
                                        class="fa fa-rupee"></i></span><span>{{cart.totalCost}}</span></div>
                        </div>
                    </div>
                    <div class="form-group mt-4">
                        <div class="col-xs-12 mt-2">
                            <div class="buttons">
                                <button id="rzp-button1" class="btn btn-success btn-block">Proceed to Payment</button> 
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--REVIEW ORDER END-->
        </div>
        <input type="hidden" name="" id="rzp-text">


        <script>
            window.onload = function (e) {

                var url = "/createOrder"
                var params = {
                    amount: "{{totalAmount}}",
                    currency: "INR",
                    receipt: "lavna_recipt",
                    payment_capture: '1'
                };
                var xmlHttp = new XMLHttpRequest();
                xmlHttp.onreadystatechange = function (res) {
                    if (xmlHttp.readyState === 4) {
                        res = JSON.parse(xmlHttp.responseText);
                        document.getElementById("rzp-text").value = res.sub.id
                    }
                }
                xmlHttp.open("POST", url, true);
                xmlHttp.setRequestHeader("Content-type", "application/json");
                xmlHttp.setRequestHeader("X-CSRF-Token", "{{csrfToken}}");
                xmlHttp.send(JSON.stringify(params));
            }
        </script>
        <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
        <script>
            document.getElementById("rzp-button1").onclick = function (e) {

                var firstname = document.getElementById("first_name").value;
                var address = document.getElementById("address").value;
                var phone = document.getElementById("phone_number").value;
                var city = document.getElementById("city").value;
                var zip = document.getElementById("zip_code").value;
                var email = document.getElementById("email").value;
                var titles = document.getElementsByClassName('title');
                var result = "";
                for (var i = 0, len = titles.length | 0; i < len; i = i + 1 | 0) {
                    result += titles[i].defaultValue + " | ";
                }
                if (firstname === '' || firstname == undefined) {
                    document.getElementById("first_name_msg").innerHTML = "Please enter First Name."
                    return;
                }

                if (address === '' || address == undefined) {
                    document.getElementById("address_msg").innerHTML = "Please enter Address."
                    return;
                }


                if (city === '' || city == undefined) {
                    document.getElementById("city_msg").innerHTML = "Please enter City."
                    return;
                }

                if (phone === '' || phone == undefined) {
                    document.getElementById("phone_number_msg").innerHTML = "Please enter Phone number."
                    return;
                }

                if (zip === '' || zip == undefined) {
                    document.getElementById("zip_code_msg").innerHTML = "Please enter Zip code."
                    return;
                }

                if (email === '' || email == undefined) {
                    document.getElementById("email_msg").innerHTML = "Please enter Email."
                    return;
                }

                var postData = {
                    "firstname": firstname,
                    "address": address,
                    "city": city,
                    "phone": phone,
                    "zip": zip,
                    "email": email,
                    "titles": result.substring(0, result.length - 2),
                    "amount": "{{total}}"
                }
                var options = {
                    "key": "{{key}}",
                    "currency": "INR",
                    "name": "Lavna Locks",
                    "description": "Lavna Locks Payment Gateway",
                    "order_id": document.getElementById("rzp-text").value,
                    "handler": function (response) {
                        var url = "/confirmOrder"
                        console.log(JSON.stringify(response))
                        var params = {
                            order_pay_id: response.razorpay_payment_id,
                            order_id: response.razorpay_order_id,
                            order_sig: response.razorpay_signature,
                            postDataJson: postData
                        };
                        console.log(JSON.stringify(params))
                        var xmlHttp = new XMLHttpRequest();
                        xmlHttp.onreadystatechange = function (res) {
                            if (xmlHttp.readyState === 4) {
                                res = JSON.parse(xmlHttp.responseText);
                                let status = res["status"];
                                if (status == "SUCCESS") {
                                    window.location.href = "/user/profile";
                                }
                                if (status == "failure") {
                                    window.location.href = "/errorpayment";
                                }
                            }
                        }
                        xmlHttp.open("POST", url, true);
                        xmlHttp.setRequestHeader("Content-type", "application/json");
                        xmlHttp.setRequestHeader("X-CSRF-Token", "{{csrfToken}}");
                        xmlHttp.send(JSON.stringify(params));
                    },
                    "theme": {
                        "color": "#0EB9F2"
                    }
                };
                var rzp1 = new Razorpay(options);
                rzp1.open();
                rzp1.on('payment.failed', function (response) {
                    console.log(JSON.stringify(response));
                    window.location.href = "/errorpayment"
                });
                e.preventDefault();
            }
        </script>
    </div>
</div>
</section>


<!-- ======= Footer ======= -->
<footer id="footer">
    <div class="container">
        <div class="footer-top">
            <div class="row">
                <div class="col-lg-12">
                    <a href="index.html" class="logo me-auto"><img width="20%" src="assets/new_assets/img2/Logo.jpg"
                            alt=""></a>
                </div>
            </div>
        </div>
        <div class="footer-mid">
            <div class="row mt-4">
                <div class="col-lg-5">
                    <div class="box">
                        <h4>Subscribe to our newsletter</h4>
                        <form id="contact-form2">
                            <input type="email" name="email" id="emailsb" placeholder="Enter Your Email"
                                required><button type="submit" id="submit-modal2">Subscribe Us</button>
                        </form>

                    </div>
                </div>
                <div class="col-lg-4">
                    <h4 class="link">Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="/about">About</a></li>
                        <li><a href="/shop">Products</a></li>
                        <li><a href="/builder">Builder’s Project</a></li>
                    </ul>
                </div>
                <div class="col-lg-3">
                    <h4 class="link">Contact Us</h4>
                    <ul>
                        <li><a href="tel:+91-18003134491"><i class="fa fa-phone"></i> +91-18003134491</a></li>
                        <li> <a href="mailto:sales@lavnalocks.com"><i class="fa fa-envelope"></i>
                                sales@lavnalocks.com</a></li>
                    </ul>
                    <ul class="lastul">
                        <li><a target="_blank" href="https://www.facebook.com/bhagwnshrilocksprivatelimited/"><img
                                    src="assets/new_assets/img2/facebook (2).svg"></a></li>
                        <li><a target="_blank" href="https://www.instagram.com/lavnalocks/"><img
                                    src="assets/new_assets/img2/instagram (1).svg"></a></li>
                        <li><a target="_blank" href="https://youtu.be/Yst8KW2Vm4M"><img
                                    src="assets/new_assets/img2/Vector (13).png"></a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <div id="f_bottom" class="container-fluid">
        <div class="row text-center">
            <div class="col-lg-12 footer-bottom">
                <div class="copyright">
                    &copy; 2022 LAVNA Locks is a Unit of Bhagwn Shri Locks PVT. LTD. All Rights Reserved.
                </div>
            </div>
        </div>
    </div>
</footer>
<!-- End Footer -->

<div id="preloader"></div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Vendor JS Files -->
<script src="assets/new_assets/vendor/aos/aos.js"></script>
<script src="assets/new_assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/new_assets/vendor/swiper/swiper-bundle.min.js"></script>

<!-- Template Main JS File -->
<script src="assets/new_assets/js/main.js"></script>
<script src="assets/new_assets/js/owl.min.js"></script>
<script src="assets/new_assets/js/custom.js"></script>


<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js">
</script>


<script type="text/javascript">
        (function () {
            emailjs.init("user_mTjMBBP092bpZsnZTyLfp");
        })();
</script>


<script>
    var swiper = new Swiper("#prd_thumb", {
        slidesPerView: 5.5,
        spaceBetween: 20,

        navigation: {
            nextEl: "#prd_thumb .swiper-button-next",
            prevEl: "#prd_thumb .swiper-button-prev",
        },

    });



    $(document).ready(function () {

        $('.chn_img').click(function () {

            $('.chn_img').removeClass('active');
            $(this).addClass('active');
            var target = $(this).attr('data-target');
            var src = $(this).attr('data-img');

            $(target).attr('src', src);

        });

    });

</script>

<script>
	$(document).ready(function(){
		$("#contact-form2").submit(function(e) {
      $('#submit-modal2').html('Sending...');
    			e.preventDefault();
			var emailId = document.getElementById("emailsb").value;
			if(emailId ==='' || emailId == undefined )
			{
				return;
			}
			var Body ='Email: '+emailId;
      $('#emailsb').val('');

      sendMailToUser(emailId);
      sendMailToOwner(Body, emailId);
			});

		});


function sendMailToUser(emailId){

var data = {
   service_id: 'service_8zp4yhp',
   template_id: 'template_kvsj7kk',
   user_id: 'user_mTjMBBP092bpZsnZTyLfp',
   template_params: {
        'user_email':emailId,
        'reply_to':'contact@lavnalocks.com',
  		  'company':"Lavnalocks",

   }

};

$.ajax('https://api.emailjs.com/api/v1.0/email/send', {
   type: 'POST',
   data: JSON.stringify(data),
   contentType: 'application/json'
}).done(function(msg) {
  // alert(msg);
  $('#submit-modal2').html('Subscribe');
  swal("Thank You!", "Your have subscribe lavnalocks", "success");
$('#closemodal').trigger('click');
}).fail(function(error) {
   alert('Oops... user mail failed' + JSON.stringify(error));
});

}
    

  function sendMailToOwner(Body, emailId){
var data = {
   service_id: 'service_8zp4yhp',
   template_id: 'template_mxovugp',
   user_id: 'user_mTjMBBP092bpZsnZTyLfp',
   template_params: {
         'user_email': emailId ,
         'reply_to':'contact@lavnalocks.com', 
         'owner_email': 'sales@lavnalocks.com',
         'company': 'Lavnalocks',
   }

};

$.ajax('https://api.emailjs.com/api/v1.0/email/send', {
   type: 'POST',
   data: JSON.stringify(data),
   contentType: 'application/json'
}).done(function() {
  $('#submit-modal').html('Send');
  swal("Thank You!", "Your Query has been submitted!", "success");
$('#closemodal').trigger('click');
}).fail(function(error) {
   alert('Oops... ' + JSON.stringify(error));
});

}

</script>

</body>

</html>